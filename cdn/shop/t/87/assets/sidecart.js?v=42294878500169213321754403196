function findGetParameter(parameterName){var result=null,tmp=[];return location.search.substr(1).split("&").forEach(function(item){tmp=item.split("="),tmp[0]===parameterName&&(result=decodeURIComponent(tmp[1]))}),result}class SideCart extends HTMLElement{constructor(){super(),this.scrollCash(),this.isOpen=!1,this.addEventListener("cart:reload",this.refreshCart.bind(this)),this.configVarsEvents(!1),findGetParameter("open")=="cart"&&(this.openSideCart(),history.pushState({},document.title,window.location.pathname)),this.empty_cart=!0,this.updateItemsHeight(),window.addEventListener("resize",this.updateItemsHeight.bind(this))}disabledLinks(urls,attr,setAttr){[...urls].forEach(url=>{url.setAttribute(attr,setAttr)})}blockedLinks(down){const allLinks=document.querySelectorAll(".url-card");down?this.disabledLinks(allLinks,"disabled","disabled"):this.disabledLinks(allLinks,"disabled","")}scrollCash(){const sliderTouch=document.querySelectorAll(".scroll-touch");let isDown=!1,startX,scrollLeft;for(let slider of sliderTouch)slider.addEventListener("mousedown",e=>{isDown=!0,slider.classList.add("active"),startX=e.pageX-slider.offsetLeft,scrollLeft=slider.scrollLeft}),slider.addEventListener("mouseleave",()=>{isDown=!1,slider.classList.remove("active"),this.blockedLinks(isDown)}),slider.addEventListener("mouseup",()=>{isDown=!1,slider.classList.remove("active"),this.blockedLinks(isDown)}),slider.addEventListener("mousemove",e=>{if(!isDown)return;e.preventDefault(),this.blockedLinks(isDown);const walk=e.pageX-slider.offsetLeft-startX;slider.scrollLeft=scrollLeft-walk})}updateItemsHeight(){let headerHeight=null,uppselHeight=null,footerHeight=null,totalHeight=0;this.querySelector(".side-cart__header")&&(headerHeight=this.querySelector(".side-cart__header").offsetHeight),this.querySelector(".side-cart .side-cart-data-scrap__container")&&(footerHeight=this.querySelector(".side-cart .side-cart-data-scrap__container").offsetHeight),this.querySelector(".uppselllllll")&&(uppselHeight=this.querySelector(".side-cart__header").offsetHeight),headerHeight!=null&&(totalHeight=totalHeight+headerHeight),uppselHeight!=null&&(totalHeight=totalHeight+uppselHeight),footerHeight!=null&&(totalHeight=totalHeight+footerHeight),document.documentElement.style.setProperty("--sidecart-items-height",`${totalHeight}px`),this.items={}}configVarsEvents(is_open){this.querySelector(".update-all__button")?.addEventListener("click",this.updateAllSubscription.bind(this)),this.querySelectorAll(".sidecart-uppsells__navigation-item ").forEach(elem=>{elem.addEventListener("click",this.toggleCollection.bind(this))}),this.querySelectorAll(".uppsels-add-to-cart").forEach(elem=>{elem.addEventListener("click",this.uppselAddToCart.bind(this))}),this.sideCartContainer=document.getElementById("section-sidecart"),this.openCartBtn=document.querySelector('[data-open="cart"]'),this.closeCartBtn=document.querySelector(".side-cart__close-button"),this.itemsCountSelector=document.querySelector("[data-cart-count]"),this.openCartBtn.addEventListener("click",this.openSideCart.bind(this)),this.closeCartBtn.addEventListener("click",this.closeSideCart.bind(this)),this.addToCart=document.querySelectorAll("[data-side-variant-id]"),this.querySelectorAll(".udpate-subscription").forEach(item=>{item.addEventListener("click",this.updateSubscription.bind(this))}),this.isOpen=is_open,this.querySelectorAll(".update__selling-plan label").forEach(item=>{item.addEventListener("click",this.updateSellingPlanId.bind(this,item))});var cartForm=document.getElementById("SideCartForm"),that=this;document.querySelector("[add-to-cart]")&&document.querySelector("[add-to-cart]").addEventListener("click",event=>{event.preventDefault(),this.addUpsell(event)}),document.querySelector("side-cart").addEventListener("click",function(event){var isClickInside=cartForm.contains(event.target),isClickIcon=that.openCartBtn.contains(event.target);!isClickInside&&!isClickIcon&&that.closeSideCart()}),this.addToCart.forEach(button=>{button.addEventListener("click",this.addToCartEvent.bind(this))});var minusQuantity=this.querySelectorAll(".side-cart-item__quantity-minus"),plusQuantity=this.querySelectorAll(".side-cart-item__quantity-plus"),removeItem=this.querySelectorAll("[data-remove-item]");minusQuantity.forEach(button=>button.addEventListener("click",this.reduceQuantity.bind(this))),plusQuantity.forEach(button=>button.addEventListener("click",this.addQuantity.bind(this))),removeItem.forEach(button=>button.addEventListener("click",this.removeItem.bind(this))),setTimeout(function(){document.querySelector(".shopify-product-form")&&document.querySelector(".shopify-product-form").addEventListener("opencart",event=>{event.preventDefault(),that.refreshCart()})},1e3),this.calculateShipping(),document.querySelector(".cart-form__icon")&&this.calculateShippingCart()}uppselAddToCart(e){const data={items:[{id:e.currentTarget.dataset.variantId,quantity:1}]};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(response=>response.json()).then(data2=>{document.querySelector("side-cart").dispatchEvent(new Event("cart:reload"))})}toggleCollection(e){let collectionHandle=e.currentTarget.dataset.collectionHandle;this.querySelectorAll(".sidecart-uppsells__navigation-item ").forEach(elem=>{elem.classList.remove("actif")}),e.currentTarget.classList.add("actif"),this.querySelectorAll(".sidecart-uppsells__collection").forEach(elem=>{elem.classList.add("hidden")}),console.log(collectionHandle),this.querySelector(`[data-collection-show-handle="${collectionHandle}"]`).classList.remove("hidden")}addToCartEvent(event){event.preventDefault();var id=event.currentTarget.getAttribute("data-side-variant-id");this.updateQuantity(id,1)}updateSubscription(event){const elem=event.currentTarget;console.log(elem),elem.querySelector("input").checked?(elem.querySelector("input").checked=!1,elem.querySelector(".udpate-subscription__checkbox").classList.remove("active"),this.updateSellingPlan(elem,!1)):(elem.querySelector("input").checked=!0,elem.querySelector(".udpate-subscription__checkbox").classList.add("active"),this.updateSellingPlan(elem,!0))}async updateAllSubscription(event){const subscriptionItems=this.querySelectorAll(".side-cart-item--subscribe"),size=subscriptionItems.length;let i=0;console.log(size);const updatePromises=Array.from(subscriptionItems).map(elem=>new Promise(resolve=>{elem.querySelector(".update-subscription__checkbox input").checked?resolve():(elem.querySelector("input").checked=!0,elem.querySelector(".update-subscription__checkbox").classList.add("active"),this.updateAllSellingPlanId(elem,!0).then(()=>{resolve()}).catch(error=>{console.error("Error updating selling plan:",error),resolve()})),i++,i===size&&console.log("Finished updating all subscriptions")}));await Promise.all(updatePromises),this.refreshCart()}async updateAllSellingPlanId(elem){const line=elem.closest("[data-cart-id]").getAttribute("data-line-item"),selling_plan_id=elem.querySelector(".update__selling-plan label").getAttribute("for").replace("selling_plan_side_",""),quantity=parseInt(elem.closest(".side-cart-item").querySelector("[data-quantity]").getAttribute("data-quantity")),url="cart/change.js",formData={line,quantity,selling_plan:selling_plan_id};console.log("Updating selling plan for line:",line,"with plan:",selling_plan_id);try{const response=await fetch(window.Shopify.routes.root+url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)});if(!response.ok)throw new Error("Network response was not ok");const state=await response.json();console.log("Updated cart state:",state)}catch(error){console.error("Error updating cart:",error)}}calculateShipping(){if(this.querySelector(".sidecart-form__icon")){let shipping_date=new Date(new Date().getTime()),shipping_delay=parseInt(this.querySelector(".sidecart-form__icon").getAttribute("data-shipping-delay"));shipping_delay==null&&(shipping_delay=parseInt(this.querySelector(".cart-form__icon").getAttribute("data-shipping-delay")));for(var i=0;i<shipping_delay;i++)shipping_date.setDate(shipping_date.getDate()+1),shipping_date.getDay()==6&&shipping_date.setDate(shipping_date.getDate()+2),shipping_date.getDay()==0&&shipping_date.setDate(shipping_date.getDate()+1);let shipping_date_format=shipping_date.toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"long",year:"numeric"});for(let i2=0;i2<document.querySelectorAll(".sidecart-form__icon").length;i2++){let html=document.querySelectorAll(".sidecart-form__icon")[i2].innerHTML;html.indexOf("[date]")>-1&&(document.querySelectorAll(".sidecart-form__icon")[i2].innerHTML=html.replace("[date]",shipping_date_format))}for(let i2=0;i2<document.querySelectorAll(".cart-form__icon").length;i2++){let html=document.querySelectorAll(".cart-form__icon")[i2].innerHTML;html.indexOf("[date]")>-1&&document.querySelector(".cart-form__icon")&&(document.querySelectorAll(".cart-form__icon")[i2].innerHTML=html.replace("[date]",shipping_date_format))}}}calculateShippingCart(){if(this.querySelector(".cart-form__icon")){let shipping_date=new Date(new Date().getTime()),shipping_delay=parseInt(this.querySelector(".cart-form__icon").getAttribute("data-shipping-delay"));for(var i=0;i<shipping_delay;i++)shipping_date.setDate(shipping_date.getDate()+1),shipping_date.getDay()==6&&shipping_date.setDate(shipping_date.getDate()+2),shipping_date.getDay()==0&&shipping_date.setDate(shipping_date.getDate()+1);let shipping_date_format=shipping_date.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});for(let i2=0;i2<document.querySelectorAll(".cart-form__icon").length;i2++){let html=document.querySelectorAll(".cart-form__icon")[i2].innerHTML;html.indexOf("[date]")>-1&&(document.querySelectorAll(".cart-form__icon")[i2].innerHTML=html.replace("[date]",shipping_date_format))}}}updateSellingPlanId(elem){const line=elem.closest("[data-cart-id]").getAttribute("data-line-item"),selling_plan_id=elem.getAttribute("for").replace("selling_plan_side_","");console.log(selling_plan_id);const quantity=parseInt(elem.closest(".side-cart-item").querySelector("[data-quantity]").getAttribute("data-quantity"));var url="cart/change.js";let formData={line,quantity,selling_plan:selling_plan_id};var that=this;fetch(window.Shopify.routes.root+url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)}).then(response=>(console.log(response),response.json())).then(state=>{console.log(state),that.refreshCart()}).catch(error=>{console.log("Error : "+error)})}updateSellingPlan(elem,is_subscription){const product_id=elem.querySelector("input").getAttribute("data-product-id"),line=elem.querySelector("input").getAttribute("data-line"),selling_plan_id=ALLPRODUCTS_PLANS[product_id].plans[1],quantity=parseInt(elem.closest(".side-cart-item").querySelector("[data-quantity]").getAttribute("data-quantity"));var url="cart/change.js";let formData={line,quantity,selling_plan:null};is_subscription&&(formData.selling_plan=selling_plan_id);var that=this;fetch(window.Shopify.routes.root+url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)}).then(response=>(console.log(response),response.json())).then(state=>{console.log(state),that.refreshCart()}).catch(error=>{console.log("Error : "+error)})}openSideCart(){if(window.innerWidth>1024&&sidecart_desktop){if(document.querySelector("#section-cart"))return;window.location.href="/cart";return}else console.log("openSideCart"),this.isOpen=!0,document.querySelector("body").classList.add("overflow-hidden-cart"),this.sideCartContainer.classList.add("side-cart--open"),this.sideCartContainer.classList.add("side-cart--indexed")}closeSideCart(){console.log("closeSideCart"),this.isOpen&&(this.isOpen=!1,document.querySelector("body").classList.remove("overflow-hidden-cart"),this.sideCartContainer.classList.remove("side-cart--open"),this.sideCartContainer.classList.remove("side-cart--indexed"))}addQuantity(event){event.preventDefault();var line_item=event.target.closest("[data-quantity]"),actual_quantity=parseInt(line_item.getAttribute("data-quantity")),variant_id=line_item.getAttribute("data-variant-id"),new_quantity=actual_quantity+1;line_item.setAttribute("data-quantity",new_quantity),line_item.querySelector(".side-cart-item__quantity-selector span + span").innerHTML=new_quantity,this.updateQuantity(variant_id,new_quantity)}reduceQuantity(event){event.preventDefault();var line_item=event.target.closest("[data-quantity]"),actual_quantity=parseInt(line_item.getAttribute("data-quantity")),variant_id=line_item.getAttribute("data-variant-id"),new_quantity=actual_quantity-1;line_item.setAttribute("data-quantity",new_quantity),line_item.querySelector(".side-cart-item__quantity-selector span").innerHTML=new_quantity,this.updateQuantity(variant_id,new_quantity)}removeItem(event){event.preventDefault(),this.updateQuantity(event.currentTarget.getAttribute("data-remove-item"),0)}updateQuantity(line,quantity){var url="/cart/update.js";const body="updates["+line+"]="+quantity;fetch(url,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state);this.refreshCart()}).catch(()=>{})}refreshCart(){fetch("/cart?view=json").then(response=>{if(response.ok)return response.text();alert("Error : Refresh cart has a problem. If you see this error please contact us.")}).then(response=>{var btn_checkout=document.querySelector(".v2-button.checkout").innerHTML,empty='<div class="side-cart__cart-empty text-center">'+document.querySelector(".side-cart__cart-empty").innerHTML+"</div>";const subtitle_btn=document.querySelector(".side-cart__checkout-info")?document.querySelector(".side-cart__checkout-info").innerHTML:"";let icons_text=document.querySelector(".sidecart-icons"),icons_paye=document.querySelector(".sidecart-icons-paye");icons_text=icons_text?icons_text.innerHTML:!1,icons_paye=icons_paye?icons_paye.innerHTML:!1,document.querySelector(".side-cart__inner").innerHTML=response,document.querySelector(".side-cart__inner").innerHTML+=empty;var nb_items=document.querySelector("[data-products]").getAttribute("data-nb-items");document.querySelectorAll("[data-cart-count]").forEach(item=>{item.innerHTML=nb_items}),nb_items>0?document.querySelectorAll("[data-cart-count]").forEach(item=>{item.classList.remove("hidden")}):document.querySelectorAll("[data-cart-count]").forEach(item=>{item.classList.add("hidden")}),document.querySelector(".v2-button.checkout")&&(document.querySelector(".v2-button.checkout ").innerHTML=btn_checkout),response.indexOf("no-product")>-1?(document.querySelector("[data-products]").classList.add("hidden"),document.querySelector("#SideCartForm").classList.add("sidecart--empty"),document.querySelector(".side-cart__inner").classList.add("side-cart__inner-empty"),document.querySelector(".side-cart__cart-empty").classList.remove("hidden"),this.empty_cart=!0):(document.querySelector("[data-products]").classList.remove("hidden"),document.querySelector(".side-cart__cart-empty").classList.add("hidden"),document.querySelector(".side-cart__inner").classList.remove("side-cart__inner-empty"),document.querySelector("#SideCartForm").classList.remove("sidecart--empty"),this.empty_cart=!1),document.querySelector("#section-cart")||this.configVarsEvents(!0);var cart_is_open=document.querySelector(".side-cart").classList.contains("side-cart--open");document.querySelector(".product-form__cart-submit")&&document.querySelector(".product-form__cart-submit").removeAttribute("aria-disabled"),icons_text&&document.querySelector(".side-cart-data-scrap").insertAdjacentHTML("afterend",'<div class="sidecart-icons">'+icons_text+"</div>"),this.updateFreeShipping(),cart_is_open||this.openSideCart()}).catch(error=>{alert(`Error : Refresh cart has a problem. If you see this error please contact us.
`+error)}),console.log(window.Shopify.routes.root),document.querySelector("#section-cart")&&fetch("/cart?view=template").then(response=>response.text()).then(html=>{const doc=new DOMParser().parseFromString(html,"text/html");console.log(doc);const newCart=doc.querySelector("#cart_page");console.log("newCart",newCart),document.querySelector("#cart_page").innerHTML=newCart.innerHTML,this.configVarsEvents(!0),setTimeout(()=>{this.calculateShipping()},1e3)})}updateFreeShipping(){const current_total=parseFloat(document.querySelector("[data-subtotal]").innerHTML.replace(",",".").replace("\u20AC","").replace(" ","")).toFixed(2),min_free_shipping=parseFloat(document.querySelector("[data-freeshipping-min]").dataset.freeshippingMin.replace(",",".").replace("\u20AC","").replace(" ","")).toFixed(2);let is_free=parseFloat(current_total)>=parseFloat(min_free_shipping),rest=min_free_shipping-current_total,percentage=current_total/min_free_shipping*100;console.log(min_free_shipping+" "+current_total+" "+is_free),document.querySelector(".udpate-subscription__checkbox.active")&&(is_free=!0,percentage=100);let percentageMax=percentage>=100?100:percentage.toFixed(0);switch(this.empty_cart?(percentageMax=0,document.querySelectorAll("[data-ship-rest]").forEach(elem=>{elem.innerHTML=min_free_shipping})):document.querySelectorAll("[data-ship-rest]").forEach(elem=>{elem.innerHTML=rest>0?rest.toFixed(2):0}),document.querySelectorAll(".sidecart__shipping-progress__bar__fill").forEach(elem=>{elem.style=`width: ${percentageMax}%;`}),is_free){case!0:document.querySelectorAll("[data-shipping-not-complete]").forEach(elem=>{elem.classList.add("hidden")}),document.querySelectorAll("[data-shipping-complete]").forEach(elem=>{elem.classList.remove("hidden")});break;case!1:document.querySelectorAll("[data-shipping-not-complete]").forEach(elem=>{elem.classList.remove("hidden")}),document.querySelectorAll("[data-shipping-complete]").forEach(elem=>{elem.classList.add("hidden")});break}}addUpsell(e){const data={items:[{id:e.currentTarget.getAttribute("add-to-cart"),quantity:1,properties:{_offered:"true"}}]};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(response=>response.json()).then(data2=>{this.refreshCart()})}addItemSimple(e){e.preventDefault();const data={items:[{id:e.currentTarget.getAttribute("data-variant-id-simple"),quantity:1}]};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(response=>response.json()).then(data2=>{this.refreshCart()})}}customElements.define("side-cart",SideCart),window.addEventListener("load",function(){document.querySelectorAll("form button[data-variant-id-simple]").forEach(button=>{button.addEventListener("click",function(e){addItemSimple(e)})})});function addItemSimple(e){e.preventDefault();const data={items:[{id:e.currentTarget.getAttribute("data-variant-id-simple"),quantity:1}]};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(response=>response.json()).then(data2=>{document.querySelector("side-cart").dispatchEvent(new Event("cart:reload"))})}class nextDelivery extends HTMLElement{constructor(){super(),this.month=parseInt(this.getAttribute("data-month"));const date=new Date;date.setMonth(date.getMonth()+this.month),this.querySelector("span").textContent=`Prochain renouvellement aura lieu le ${date.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`}}customElements.define("next-delivery",nextDelivery);
//# sourceMappingURL=/cdn/shop/t/87/assets/sidecart.js.map?v=42294878500169213321754403196
